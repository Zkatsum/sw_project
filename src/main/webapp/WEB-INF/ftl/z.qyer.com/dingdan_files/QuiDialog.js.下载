define(["web_qui_controlbase","web_qui_quipopup","css!web_qui_quidialog"],function(t,o){"use strict";function n(t){this.init(t)}var i=jQuery;return n.prototype=new t,n.prototype.constructor=n,i.extend(n.prototype,{_popup:null,_option:{width:300,isCloseTriggerCancel:!0},_showOption:{},setConfig:function(t){if("object"!=typeof t)throw new Error("Parameter error");i.extend(this._option,t);var o=this._option.exClassName||"";return delete this._option.exClassName,this._popup.setConfig(this._option),this._option.exClassName=o,this._updateUI(),this},_updateUI:function(){return i(this._popup.getDom()).find(".qui-popup-box")[0].className="qui-popup-box "+this._option.exClassName,this},_events:{onOK:function(t,o){if("function"==typeof o._showOption.onOK){if(o._showOption.onOK(t)===!1)return!1;o.close(t,!1)}else o.close(t,!1)},onCancel:function(t,o){if("function"==typeof o._showOption.onCancel){if(o._showOption.onCancel(t)===!1)return!1;o.close(t,!1)}else o.close(t,!1)},onPopopClose:function(t,o){return o._option.isCloseTriggerCancel&&"function"==typeof o._showOption.onCancel?o._showOption.onCancel(t):void 0}},_bindEvent:function(){var t=this,o=this._events;return i(this._popup.getDom()).on("click",".qui-dialog-okBtn",function(n){o.onOK(n,t)}).on("click",".qui-dialog-cancelBtn",function(n){o.onCancel(n,t)}),this},init:function(t){i.extend(this._option,t),this._create().setConfig(this._option)._bindEvent()},_create:function(){return this._popup=new o({exClassName:"qui-dialog"}),this},destroy:function(){this._popup.destroy()},_getHTML:function(t){var o={ok:"qui-dialog-box-content-iconOK",error:"qui-dialog-box-content-iconError",warning:"qui-dialog-box-content-iconWarning"},n=[];return t.__opt__.icon=o[t.type],n.push('<div class="qui-dialog-box-content clearfix">'),n.push('<div class="qui-dialog-box-content-icon '+t.__opt__.icon+'">&nbsp;</div>'),n.push('<div class="qui-dialog-box-content-text">'+t.content+"</div>"),n.push("</div>"),n.push('<div class="qui-dialog-box-bottom">'),t.__opt__.okBtn&&n.push('<input class="qui-dialog-okBtn ui_btn_small" type="button" value="'+t.okText+'" />'),t.__opt__.cancelBtn&&n.push('<input class="qui-dialog-cancelBtn ui_btn_small_cancel" type="button" value="'+t.cancelText+'" />'),t.__opt__.loadingBtn&&n.push('<input class="qui-dialog-loadingBtn ui_btn_small_load" style="display:none;" type="button" value="" />'),n.push("</div>"),n.join("")},alert:function(t){this._showOption=t||{};var o=this._getHTML({okText:t.okText||"确定",calcelText:t.calcelText||"取消",content:t.text,type:t.type||"ok",__opt__:{okBtn:!0,cancelBtn:!1,loadingBtn:!1}}),n=this;this._popup.show({title:t.title,contentHTML:o,onClose:function(t){return n._events.onPopopClose(t,n)}})},confirm:function(t){this._showOption=t||{};var o=this._getHTML({okText:t.okText||"确定",cancelText:t.cancelText||"取消",content:t.text,type:t.type||"ok",__opt__:{okBtn:!0,cancelBtn:!0,loadingBtn:!0}}),n=this;this._popup.show({title:t.title,contentHTML:o,onClose:function(t){return n._events.onPopopClose(t,n)}})},custom:function(t){this._showOption=t||{};var o=this._getHTML({content:t.text,okText:t.okText||"确定",cancelText:t.cancelText||"取消",type:"ok",__opt__:{okBtn:!0,cancelBtn:!0,loadingBtn:!0}}),n=this;this._popup.show({title:t.title,contentHTML:o,onClose:function(t){return n._events.onPopopClose(t,n)}}),i(this._popup.getDom()).find(".qui-dialog-box-content").addClass("qui-dialog-box-content-noIcon")},close:function(t,o){this._popup.close(t,o)},setLoadingState:function(){i(this._popup.getDom()).find(".qui-dialog-box-bottom > input").hide().end().find(".qui-dialog-loadingBtn").show(),this._popup.setConfig({isDisableCloseIcon:!0})},unSetLoadingState:function(){i(this._popup.getDom()).find(".qui-dialog-box-bottom > input").show().end().find(".qui-dialog-loadingBtn").hide(),this._popup.setConfig({isDisableCloseIcon:!1})},getDom:function(t){return this._popup.getDom()}}),n});